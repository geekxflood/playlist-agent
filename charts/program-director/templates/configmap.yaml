apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "program-director.fullname" . }}
  labels:
    {{- include "program-director.labels" . | nindent 4 }}
data:
  config.yaml: |
    debug: {{ .Values.config.debug }}

    database:
      driver: {{ .Values.config.database.driver }}
      {{- if eq .Values.config.database.driver "sqlite" }}
      sqlite:
        path: {{ .Values.config.database.sqlite.path }}
      {{- else if eq .Values.config.database.driver "postgres" }}
      postgres:
        host: {{ .Values.config.database.postgres.host }}
        port: {{ .Values.config.database.postgres.port }}
        database: {{ .Values.config.database.postgres.database }}
        user: {{ .Values.config.database.postgres.user }}
        sslmode: {{ .Values.config.database.postgres.sslmode }}
      {{- end }}

    radarr:
      url: {{ .Values.config.radarr.url }}

    sonarr:
      url: {{ .Values.config.sonarr.url }}

    tunarr:
      url: {{ .Values.config.tunarr.url }}

    {{- if or .Values.config.trakt.clientId .Values.config.trakt.clientSecret }}
    trakt:
      {{- if .Values.config.trakt.clientId }}
      client_id: ""  # Loaded from environment
      {{- end }}
      {{- if .Values.config.trakt.clientSecret }}
      client_secret: ""  # Loaded from environment
      {{- end }}
    {{- end }}

    ollama:
      url: {{ .Values.config.ollama.url }}
      model: {{ .Values.config.ollama.model }}
      temperature: {{ .Values.config.ollama.temperature }}
      num_ctx: {{ .Values.config.ollama.numCtx }}

    cooldown:
      movie_days: {{ .Values.config.cooldown.movieDays }}
      series_days: {{ .Values.config.cooldown.seriesDays }}
      anime_days: {{ .Values.config.cooldown.animeDays }}

    server:
      port: {{ .Values.config.server.port }}
      enable_scheduler: {{ .Values.config.server.enableScheduler }}
      metrics_enabled: {{ .Values.config.server.metricsEnabled }}
      shutdown_timeout: {{ .Values.config.server.shutdownTimeout }}

    {{- if .Values.config.themes }}
    themes:
      {{- range .Values.config.themes }}
      - name: {{ .name }}
        description: {{ .description | quote }}
        channel_id: {{ .channelId | quote }}
        {{- with .schedule }}
        schedule: {{ . | quote }}
        {{- end }}
        {{- with .mediaTypes }}
        media_types:
          {{- toYaml . | nindent 10 }}
        {{- end }}
        {{- with .genres }}
        genres:
          {{- toYaml . | nindent 10 }}
        {{- end }}
        {{- with .keywords }}
        keywords:
          {{- toYaml . | nindent 10 }}
        {{- end }}
        {{- with .minRating }}
        min_rating: {{ . }}
        {{- end }}
        {{- with .maxItems }}
        max_items: {{ . }}
        {{- end }}
        {{- with .duration }}
        duration: {{ . }}
        {{- end }}
      {{- end }}
    {{- else }}
    themes: []
    {{- end }}
